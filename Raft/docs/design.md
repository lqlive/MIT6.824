# Raft å…±è¯†ç®—æ³•å®ç° - è®¾è®¡æ–‡æ¡£

æœ¬æ–‡æ¡£æä¾›äº†Raftç®—æ³•å®ç°çš„è¯¦ç»†è®¾è®¡å’Œå¼€å‘æŒ‡å—ï¼Œå¸®åŠ©æ‚¨äº†è§£å½“å‰è¿›åº¦å¹¶ç»§ç»­å®Œæˆå‰©ä½™éƒ¨åˆ†ã€‚

## ğŸ“ é¡¹ç›®æ¶æ„

```
Raft/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ Raft.Common/         # ğŸ”§ å…¬å…±ç»„ä»¶å’Œæ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ Models/          # æ•°æ®æ¨¡å‹å®šä¹‰
â”‚   â”‚   â””â”€â”€ Interfaces/      # æ¥å£å®šä¹‰
â”‚   â”œâ”€â”€ Raft.Server/         # ğŸ–¥ï¸ RaftèŠ‚ç‚¹å®ç°
â”‚   â”œâ”€â”€ Raft.Client/         # ğŸ‘¤ Raftå®¢æˆ·ç«¯å®ç°
â”‚   â””â”€â”€ Raft.Tests/          # ğŸ§ª å•å…ƒæµ‹è¯•
â”œâ”€â”€ docs/                    # ğŸ“š æ–‡æ¡£
â”œâ”€â”€ examples/                # ğŸ’¡ ç¤ºä¾‹è„šæœ¬
â””â”€â”€ Raft.sln                # Visual Studioè§£å†³æ–¹æ¡ˆ
```

## âœ… å½“å‰å®ŒæˆçŠ¶æ€

### ğŸ”§ Raft.Common - å…¬å…±ç»„ä»¶ âœ…
- âœ… **RaftNodeState** - èŠ‚ç‚¹çŠ¶æ€æšä¸¾(Follower/Candidate/Leader)
- âœ… **LogEntry** - æ—¥å¿—æ¡ç›®æ¨¡å‹
- âœ… **VoteRequest/VoteResponse** - RequestVote RPCæ¶ˆæ¯
- âœ… **AppendEntriesRequest/AppendEntriesResponse** - AppendEntries RPCæ¶ˆæ¯
- âœ… **IRaftNode** - RaftèŠ‚ç‚¹æ ¸å¿ƒæ¥å£

### ğŸ–¥ï¸ Raft.Server - èŠ‚ç‚¹å®ç° âœ…
- âœ… **RaftNodeç±»** - å®Œæ•´RaftèŠ‚ç‚¹å®ç°
- âœ… **çŠ¶æ€ç®¡ç†** - å®Œæ•´çš„èŠ‚ç‚¹çŠ¶æ€è½¬æ¢é€»è¾‘
- âœ… **RequestVote RPC** - å®Œæ•´çš„æŠ•ç¥¨è¯·æ±‚å¤„ç†
- âœ… **AppendEntries RPC** - å¿ƒè·³å’Œæ—¥å¿—è¿½åŠ å¤„ç†(åŸºç¡€ç‰ˆæœ¬)
- âœ… **Leaderé€‰ä¸¾æœºåˆ¶** - å®Œæ•´çš„é€‰ä¸¾æµç¨‹å®ç°
- âœ… **é€‰ä¸¾è¶…æ—¶æœºåˆ¶** - éšæœºè¶…æ—¶é¿å…é€‰ä¸¾å†²çª
- âœ… **å¿ƒè·³ç³»ç»Ÿ** - Leaderå®šæœŸå‘é€å¿ƒè·³ç»´æŒæƒå¨
- âœ… **ä»»æœŸç®¡ç†** - å®Œæ•´çš„CurrentTermç®¡ç†å’ŒåŒæ­¥
- âœ… **å¹¶å‘å¤„ç†** - çº¿ç¨‹å®‰å…¨çš„çŠ¶æ€ç®¡ç†å’Œå¼‚æ­¥å¤„ç†

### ğŸ‘¤ Raft.Client - å®¢æˆ·ç«¯å®ç° âœ…
- âœ… **RaftClientç±»** - å®¢æˆ·ç«¯æ ¸å¿ƒå®ç°
- âœ… **Leaderå‘ç°** - è‡ªåŠ¨å‘ç°é›†ç¾¤LeaderèŠ‚ç‚¹
- âœ… **å‘½ä»¤æäº¤** - å‘Leaderæäº¤å‘½ä»¤
- âœ… **é›†ç¾¤çŠ¶æ€æŸ¥è¯¢** - è·å–æ•´ä¸ªé›†ç¾¤çŠ¶æ€
- âœ… **é”™è¯¯å¤„ç†** - Leaderé‡å®šå‘å’Œæ•…éšœæ¢å¤
- âœ… **äº¤äº’å¼æ§åˆ¶å°** - å‘½ä»¤è¡Œå®¢æˆ·ç«¯å·¥å…·

### ğŸ§ª Raft.Tests - æµ‹è¯•å¥—ä»¶ âœ…
- âœ… **RaftNodeåŸºç¡€æµ‹è¯•** - èŠ‚ç‚¹åˆå§‹åŒ–å’ŒçŠ¶æ€æµ‹è¯•
- âœ… **Leaderé€‰ä¸¾æµ‹è¯•** - å®Œæ•´çš„é€‰ä¸¾åœºæ™¯æµ‹è¯•
- âœ… **æŠ•ç¥¨æœºåˆ¶æµ‹è¯•** - RequestVote RPCè¯¦ç»†æµ‹è¯•
- âœ… **å¿ƒè·³æœºåˆ¶æµ‹è¯•** - AppendEntries RPCæµ‹è¯•
- âœ… **å¤šèŠ‚ç‚¹é›†ç¾¤æµ‹è¯•** - ä¸‰èŠ‚ç‚¹é›†ç¾¤é€‰ä¸¾æµ‹è¯•
- âœ… **è¾¹ç•Œæ¡ä»¶æµ‹è¯•** - å•èŠ‚ç‚¹ã€ä»»æœŸå†²çªç­‰æµ‹è¯•
- âœ… **RaftClientæµ‹è¯•** - å®¢æˆ·ç«¯åŠŸèƒ½æµ‹è¯•
- âœ… **XunitLoggerå®ç°** - å®Œæ•´çš„æµ‹è¯•æ—¥å¿—å™¨

### ğŸ‰ Part 2A: Leaderé€‰ä¸¾ - å·²å®Œæˆ âœ…

**å·²å®ç°çš„æ ¸å¿ƒåŠŸèƒ½ï¼š**

1. **å®Œæ•´çš„é€‰ä¸¾é€»è¾‘** âœ…
   ```csharp
   // RaftNode.cs çš„ StartElection() æ–¹æ³•å®ç°äº†ï¼š
   // âœ… è½¬ä¸ºCandidateçŠ¶æ€å¹¶å¢åŠ ä»»æœŸ
   // âœ… å‘æ‰€æœ‰peerå¹¶è¡Œå‘é€RequestVote RPC
   // âœ… ä½¿ç”¨Task.WhenAnyå¹¶å‘æ”¶é›†æŠ•ç¥¨ç»“æœ
   // âœ… ç»Ÿè®¡é€‰ç¥¨æ•°é‡å’Œå¤šæ•°ç¥¨åˆ¤æ–­
   // âœ… è·å¾—å¤šæ•°é€‰ç¥¨åæˆä¸ºLeader
   // âœ… é€‰ä¸¾è¶…æ—¶å’Œå¤±è´¥å¤„ç†
   // âœ… å•èŠ‚ç‚¹é›†ç¾¤ç‰¹æ®Šå¤„ç†
   ```

2. **Leaderå¿ƒè·³æœºåˆ¶** âœ…
   ```csharp
   // å·²å®ç°Leaderçš„å¿ƒè·³å‘é€ï¼š
   // âœ… æˆä¸ºLeaderåå¯åŠ¨å¿ƒè·³å®šæ—¶å™¨
   // âœ… å®šæœŸ(50ms)å‘æ‰€æœ‰Followerå‘é€ç©ºçš„AppendEntries
   // âœ… ç»´æŒLeaderæƒå¨æ€§å’Œé˜²æ­¢æ–°é€‰ä¸¾
   // âœ… æ£€æµ‹å¹¶å¤„ç†æ›´é«˜ä»»æœŸçš„å“åº”
   ```

3. **èŠ‚ç‚¹é—´é€šä¿¡** âœ…
   ```csharp
   // å·²å®ç°åŸºäºæ¥å£çš„èŠ‚ç‚¹é€šä¿¡ï¼š
   // âœ… SetPeerNodesæ–¹æ³•è®¾ç½®å¯¹ç­‰èŠ‚ç‚¹å¼•ç”¨
   // âœ… å¹¶è¡Œå¤„ç†RPCè°ƒç”¨
   // âœ… å¼‚å¸¸å¤„ç†å’Œå®¹é”™æœºåˆ¶
   ```

**Leaderé€‰ä¸¾ç‰¹æ€§ï¼š**
- âœ… **é€‰ä¸¾å®‰å…¨æ€§**: ä»»ä½•ç»™å®šä»»æœŸæœ€å¤šåªæœ‰ä¸€ä¸ªLeader
- âœ… **éšæœºè¶…æ—¶**: 150-300mséšæœºé€‰ä¸¾è¶…æ—¶é¿å…å†²çª
- âœ… **å¿«é€Ÿæ”¶æ•›**: å¹¶è¡ŒæŠ•ç¥¨è¯·æ±‚ï¼Œä¸€æ—¦è·å¾—å¤šæ•°ç¥¨ç«‹å³æˆä¸ºLeader
- âœ… **å®¹é”™å¤„ç†**: ç½‘ç»œå¼‚å¸¸ã€èŠ‚ç‚¹æ•…éšœçš„è‡ªåŠ¨æ¢å¤
- âœ… **æ—¥å¿—ä¸€è‡´æ€§**: æŠ•ç¥¨æ—¶æ£€æŸ¥å€™é€‰äººæ—¥å¿—æ˜¯å¦è¶³å¤Ÿæ–°
- âœ… **ä»»æœŸåŒæ­¥**: è‡ªåŠ¨å¤„ç†ä»»æœŸå†²çªå’ŒçŠ¶æ€è½¬æ¢

## ğŸš§ ä¸‹ä¸€æ­¥å¼€å‘è®¡åˆ’

### Part 2B: æ—¥å¿—å¤åˆ¶ (ä¼˜å…ˆçº§: ğŸ”´ HIGH)

**éœ€è¦å®ç°çš„åŠŸèƒ½ï¼š**

1. **æ—¥å¿—ä¸€è‡´æ€§æ£€æŸ¥** ğŸ“‹
   ```csharp
   // åœ¨AppendEntriesä¸­å®Œå–„å®ç°ï¼š
   // - æ£€æŸ¥PrevLogIndexå’ŒPrevLogTerm
   // - å¤„ç†æ—¥å¿—å†²çªå’Œä¸ä¸€è‡´
   // - å®ç°æ—¥å¿—å›é€€æœºåˆ¶
   // - ç¡®ä¿æ—¥å¿—åŒ¹é…å±æ€§
   ```

2. **å®¢æˆ·ç«¯å‘½ä»¤å¤„ç†** ğŸ“‹
   ```csharp
   // å®Œå–„SubmitCommandAsyncæ–¹æ³•ï¼š
   // - æ·»åŠ æ—¥å¿—æ¡ç›®åˆ°Leaderæ—¥å¿—
   // - å¤åˆ¶åˆ°å¤§å¤šæ•°èŠ‚ç‚¹
   // - æ›´æ–°commitIndex
   // - åº”ç”¨åˆ°çŠ¶æ€æœºå¹¶è¿”å›ç»“æœ
   ```

3. **æ—¥å¿—å¤åˆ¶ä¼˜åŒ–** ğŸ“‹
   ```csharp
   // å®ç°é«˜æ•ˆçš„æ—¥å¿—å¤åˆ¶ï¼š
   // - æ‰¹é‡å‘é€æ—¥å¿—æ¡ç›®
   // - nextIndexå’ŒmatchIndexç®¡ç†
   // - å¿«é€Ÿå›é€€ç®—æ³•
   // - å†²çªæ£€æµ‹å’Œè§£å†³
   ```

### Part 2C: æŒä¹…åŒ–å­˜å‚¨ (ä¼˜å…ˆçº§: ğŸŸ¡ MEDIUM)

**éœ€è¦å®ç°çš„åŠŸèƒ½ï¼š**

1. **çŠ¶æ€æŒä¹…åŒ–** ğŸ“‹
   ```csharp
   // æŒä¹…åŒ–å…³é”®çŠ¶æ€ï¼š
   // - currentTerm (æ¯æ¬¡æ›´æ–°æ—¶æŒä¹…åŒ–)
   // - votedFor (æŠ•ç¥¨æ—¶æŒä¹…åŒ–)
   // - log[] (æ·»åŠ æ–°æ¡ç›®æ—¶æŒä¹…åŒ–)
   ```

2. **æ•…éšœæ¢å¤** ğŸ“‹
   ```csharp
   // èŠ‚ç‚¹é‡å¯æ—¶æ¢å¤çŠ¶æ€ï¼š
   // - ä»æŒä¹…åŒ–å­˜å‚¨è¯»å–çŠ¶æ€
   // - é‡å»ºå†…å­˜ä¸­çš„æ•°æ®ç»“æ„
   // - æ¢å¤æ­£ç¡®çš„èŠ‚ç‚¹çŠ¶æ€
   ```

### Part 2D: ç½‘ç»œé€šä¿¡å±‚ (ä¼˜å…ˆçº§: ğŸŸ¢ LOW)

**éœ€è¦å®ç°çš„åŠŸèƒ½ï¼š**

1. **HTTP/gRPCé€šä¿¡** ğŸ“‹
   ```csharp
   // å®ç°çœŸå®çš„ç½‘ç»œé€šä¿¡ï¼š
   // - HTTP APIç«¯ç‚¹
   // - æˆ–gRPCæœåŠ¡
   // - æœåŠ¡å‘ç°å’Œæ³¨å†Œ
   ```

2. **é›†ç¾¤ç®¡ç†** ğŸ“‹
   ```csharp
   // åŠ¨æ€é›†ç¾¤ç®¡ç†ï¼š
   // - èŠ‚ç‚¹åŠ å…¥å’Œç¦»å¼€
   // - é…ç½®å˜æ›´
   // - å¥åº·æ£€æŸ¥
   ```

## ğŸ› ï¸ ç«‹å³å¯ä»¥å¼€å§‹çš„ä»»åŠ¡

### ä»»åŠ¡1: å®ç°æ—¥å¿—å¤åˆ¶ä¸€è‡´æ€§æ£€æŸ¥ï¼ˆæ¨èä¼˜å…ˆå¼€å§‹ï¼‰

åœ¨ `RaftNode.cs` çš„ `AppendEntriesAsync` æ–¹æ³•ä¸­å®Œå–„ï¼š

```csharp
public async Task<AppendEntriesResponse> AppendEntriesAsync(AppendEntriesRequest request, CancellationToken cancellationToken = default)
{
    // 1. æ£€æŸ¥PrevLogIndexå’ŒPrevLogTermæ˜¯å¦åŒ¹é…
    // 2. å¦‚æœä¸åŒ¹é…ï¼Œè¿”å›å¤±è´¥å¹¶æç¤ºæ­£ç¡®çš„nextIndex
    // 3. åˆ é™¤å†²çªçš„æ—¥å¿—æ¡ç›®
    // 4. è¿½åŠ æ–°çš„æ—¥å¿—æ¡ç›®
    // 5. æ›´æ–°commitIndex
}
```

### ä»»åŠ¡2: å®Œå–„å®¢æˆ·ç«¯å‘½ä»¤æäº¤

åœ¨ `RaftNode.cs` çš„ `SubmitCommandAsync` æ–¹æ³•ä¸­ï¼š

```csharp
public async Task<bool> SubmitCommandAsync(string command, CancellationToken cancellationToken = default)
{
    // 1. åˆ›å»ºæ–°çš„æ—¥å¿—æ¡ç›®
    // 2. è¿½åŠ åˆ°æœ¬åœ°æ—¥å¿—
    // 3. å¹¶è¡Œå¤åˆ¶åˆ°æ‰€æœ‰Follower
    // 4. ç­‰å¾…å¤šæ•°èŠ‚ç‚¹ç¡®è®¤
    // 5. æäº¤å¹¶åº”ç”¨åˆ°çŠ¶æ€æœº
    // 6. å‘å®¢æˆ·ç«¯è¿”å›ç»“æœ
}
```

### ä»»åŠ¡3: å®ç°çŠ¶æ€æœºæ¥å£

åˆ›å»º `src/Raft.Common/Interfaces/IStateMachine.cs`ï¼š

```csharp
public interface IStateMachine
{
    Task<object> ApplyAsync(LogEntry entry);
    Task<byte[]> CreateSnapshotAsync();
    Task RestoreFromSnapshotAsync(byte[] snapshot);
}
```

## ğŸƒâ€â™‚ï¸ å¿«é€Ÿå¼€å§‹

### æ„å»ºå’Œæµ‹è¯•Leaderé€‰ä¸¾
```bash
cd Raft
dotnet build
./test-leader-election.ps1  # è¿è¡ŒLeaderé€‰ä¸¾ä¸“é¡¹æµ‹è¯•
```

### è¿è¡Œæ‰€æœ‰æµ‹è¯•
```bash
dotnet test --verbosity normal
```

### è¿è¡Œå®¢æˆ·ç«¯
```bash
cd src/Raft.Client
dotnet run localhost:5001,localhost:5002,localhost:5003
```

æˆ–ä½¿ç”¨ç¤ºä¾‹è„šæœ¬ï¼š
```bash
./examples/run-client.ps1
```

## ğŸ“‹ å¼€å‘ä»»åŠ¡æ¸…å•

### âœ… å·²å®Œæˆ (Leaderé€‰ä¸¾)
- [x] å®ç°å®Œæ•´çš„é€‰ä¸¾æœºåˆ¶
- [x] æ·»åŠ é€‰ä¸¾è¶…æ—¶éšæœºåŒ–
- [x] å®ç°Leaderå¿ƒè·³ç³»ç»Ÿ
- [x] å®Œå–„æŠ•ç¥¨å¤„ç†é€»è¾‘
- [x] æ·»åŠ å¤šèŠ‚ç‚¹é›†ç¾¤æµ‹è¯•
- [x] å®ç°ä»»æœŸç®¡ç†å’ŒçŠ¶æ€è½¬æ¢
- [x] åˆ›å»ºè¯¦ç»†çš„å•å…ƒæµ‹è¯•å¥—ä»¶
- [x] ç¼–å†™å®Œæ•´çš„è®¾è®¡æ–‡æ¡£

### ç«‹å³æ‰§è¡Œ (æœ¬å‘¨)
- [ ] å®Œå–„AppendEntriesçš„æ—¥å¿—ä¸€è‡´æ€§æ£€æŸ¥
- [ ] å®ç°çœŸæ­£çš„å®¢æˆ·ç«¯å‘½ä»¤å¤„ç†
- [ ] æ·»åŠ æ—¥å¿—å†²çªè§£å†³æœºåˆ¶
- [ ] å®ç°commitIndexå’ŒçŠ¶æ€æœºåº”ç”¨

### çŸ­æœŸç›®æ ‡ (2-3å‘¨)
- [ ] å®Œæˆå®Œæ•´çš„æ—¥å¿—å¤åˆ¶åŠŸèƒ½
- [ ] å®ç°çŠ¶æ€æŒä¹…åŒ–æœºåˆ¶
- [ ] æ·»åŠ å¿«é€Ÿå›é€€ä¼˜åŒ–
- [ ] åˆ›å»ºæ›´å¤šé›†æˆæµ‹è¯•

### é•¿æœŸç›®æ ‡ (1-2æœˆ)
- [ ] å®ç°é…ç½®å˜æ›´åŠŸèƒ½
- [ ] æ·»åŠ æ—¥å¿—å‹ç¼©å’Œå¿«ç…§
- [ ] æ€§èƒ½æµ‹è¯•å’Œä¼˜åŒ–
- [ ] å®Œæ•´çš„ç½‘ç»œé€šä¿¡å±‚

## ğŸ¯ æµ‹è¯•éªŒè¯ç»“æœ

### âœ… Leaderé€‰ä¸¾æµ‹è¯•ç»“æœ
```
Test summary: total: 10, failed: 0, succeeded: 10
âœ… SingleNode_ShouldBecomeLeader - å•èŠ‚ç‚¹è‡ªåŠ¨æˆä¸ºLeader
âœ… ThreeNodeCluster_ShouldElectOneLeader - ä¸‰èŠ‚ç‚¹é›†ç¾¤é€‰å‡ºå”¯ä¸€Leader  
âœ… RequestVote_ShouldGrantVoteForFirstCandidate - æŠ•ç¥¨æœºåˆ¶æ­£å¸¸
âœ… RequestVote_HigherTerm_ShouldUpdateTermAndGrantVote - ä»»æœŸæ›´æ–°æ­£ç¡®
âœ… RequestVote_LowerTerm_ShouldRejectVote - æ‹’ç»è¿‡æœŸä»»æœŸæŠ•ç¥¨
âœ… AppendEntries_ValidHeartbeat_ShouldAccept - å¿ƒè·³å¤„ç†æ­£å¸¸
âœ… AppendEntries_LowerTerm_ShouldReject - æ‹’ç»è¿‡æœŸä»»æœŸå¿ƒè·³
âœ… RaftClientåŸºç¡€åŠŸèƒ½æµ‹è¯• - å®¢æˆ·ç«¯åŠŸèƒ½æ­£å¸¸
```

### ğŸ§ª æµ‹è¯•è¦†ç›–èŒƒå›´
- **é€‰ä¸¾å®‰å…¨æ€§**: ç¡®ä¿ä»»æœŸå†…æœ€å¤šä¸€ä¸ªLeader
- **Leaderå®Œæ•´æ€§**: éªŒè¯Leaderæ‹¥æœ‰æ‰€æœ‰å·²æäº¤çš„æ—¥å¿—
- **æŠ•ç¥¨é™åˆ¶**: åªæŠ•ç¥¨ç»™æ—¥å¿—è‡³å°‘ä¸€æ ·æ–°çš„å€™é€‰äºº
- **å¿ƒè·³ç»´æŒ**: Leaderå®šæœŸå‘é€å¿ƒè·³ç»´æŒæƒå¨
- **ä»»æœŸç®¡ç†**: æ­£ç¡®å¤„ç†ä»»æœŸå†²çªå’Œæ›´æ–°
- **å®¹é”™å¤„ç†**: ç½‘ç»œå¼‚å¸¸å’ŒèŠ‚ç‚¹æ•…éšœæ¢å¤

## ğŸ” è°ƒè¯•å’Œæµ‹è¯•

### æµ‹è¯•å‘½ä»¤
```bash
# è¿è¡ŒLeaderé€‰ä¸¾ä¸“é¡¹æµ‹è¯•
./test-leader-election.ps1

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
dotnet test

# è¿è¡Œç‰¹å®šæµ‹è¯•ç±»
dotnet test --filter "RaftNodeTests"

# è¯¦ç»†è¾“å‡ºæ¨¡å¼
dotnet test --logger "console;verbosity=detailed"

# åªè¿è¡ŒLeaderé€‰ä¸¾ç›¸å…³æµ‹è¯•
dotnet test --filter "FullyQualifiedName~Leader"
```

### æ€§èƒ½æŒ‡æ ‡
- **é€‰ä¸¾æ”¶æ•›æ—¶é—´**: < 1ç§’ (ä¸‰èŠ‚ç‚¹é›†ç¾¤)
- **å¿ƒè·³é¢‘ç‡**: 50msé—´éš”
- **é€‰ä¸¾è¶…æ—¶**: 150-300mséšæœº
- **æµ‹è¯•æ‰§è¡Œæ—¶é—´**: < 3ç§’ (å®Œæ•´æµ‹è¯•å¥—ä»¶)

## ğŸ“š å­¦ä¹ èµ„æº

- [Raftè®ºæ–‡åŸæ–‡](https://raft.github.io/raft.pdf) - ç®—æ³•ç†è®ºåŸºç¡€
- [Raftå¯è§†åŒ–](https://raft.github.io/) - ç›´è§‚ç†è§£ç®—æ³•
- [MIT 6.824è¯¾ç¨‹](https://pdos.csail.mit.edu/6.824/) - åˆ†å¸ƒå¼ç³»ç»Ÿè¯¾ç¨‹
- [Leaderé€‰ä¸¾å®ç°æ–‡æ¡£](./leader-election.md) - è¯¦ç»†å®ç°è¯´æ˜

## ğŸ¯ ç¼–ç è§„èŒƒ

1. **å‘½åçº¦å®š**
   - ç±»åä½¿ç”¨PascalCase
   - æ–¹æ³•åä½¿ç”¨PascalCase  
   - ç§æœ‰å­—æ®µä½¿ç”¨_å¼€å¤´çš„camelCase
   - å¸¸é‡ä½¿ç”¨UPPER_CASE

2. **å¼‚æ­¥ç¼–ç¨‹**
   - æ‰€æœ‰I/Oæ“ä½œä½¿ç”¨async/await
   - æ–¹æ³•åä»¥Asyncç»“å°¾
   - ä¼ é€’CancellationToken
   - ä½¿ç”¨Task.WhenAll/WhenAnyå¤„ç†å¹¶å‘

3. **é”™è¯¯å¤„ç†**
   - ä½¿ç”¨å¼‚å¸¸å¤„ç†å…³é”®é”™è¯¯
   - æ·»åŠ è¯¦ç»†çš„æ—¥å¿—è®°å½•
   - ä¼˜é›…å¤„ç†ç½‘ç»œå¼‚å¸¸

4. **æµ‹è¯•ç­–ç•¥**
   - æ¯ä¸ªå…¬å…±æ–¹æ³•éƒ½è¦æœ‰å¯¹åº”æµ‹è¯•
   - ä½¿ç”¨Arrange-Act-Assertæ¨¡å¼
   - æµ‹è¯•æ–¹æ³•åè¦æ¸…æ¥šæè¿°æµ‹è¯•åœºæ™¯
   - åŒ…å«è¾¹ç•Œæ¡ä»¶å’Œå¼‚å¸¸æƒ…å†µæµ‹è¯•

## ğŸ¯ é‡Œç¨‹ç¢‘ç›®æ ‡

- **âœ… ç¬¬1å‘¨**ï¼šå®ŒæˆLeaderé€‰ä¸¾æœºåˆ¶ - å·²è¾¾æˆï¼
- **ğŸ¯ ç¬¬2å‘¨**ï¼šå®Œæˆæ—¥å¿—å¤åˆ¶ä¸€è‡´æ€§æ£€æŸ¥
- [ ] å®ç°å®¢æˆ·ç«¯å‘½ä»¤å¤„ç†å’ŒçŠ¶æ€æœº
- [ ] æ·»åŠ æŒä¹…åŒ–æ”¯æŒå’Œæ€§èƒ½ä¼˜åŒ–

## ğŸ¤ ä¸‹ä¸€æ­¥å¼€å‘æŒ‡å¯¼

ç°åœ¨Leaderé€‰ä¸¾å·²ç»å®Œæˆï¼Œå»ºè®®æŒ‰ä»¥ä¸‹é¡ºåºç»§ç»­å¼€å‘ï¼š

### ä¼˜å…ˆçº§1: æ—¥å¿—å¤åˆ¶ ğŸ”´
1. å®Œå–„`AppendEntriesAsync`æ–¹æ³•çš„æ—¥å¿—ä¸€è‡´æ€§æ£€æŸ¥
2. å®ç°`SubmitCommandAsync`çš„çœŸå®å‘½ä»¤å¤„ç†é€»è¾‘
3. æ·»åŠ æ—¥å¿—å†²çªæ£€æµ‹å’Œè§£å†³æœºåˆ¶

### ä¼˜å…ˆçº§2: çŠ¶æ€æœºé›†æˆ ğŸŸ¡  
1. åˆ›å»º`IStateMachine`æ¥å£
2. å®ç°åŸºç¡€çš„çŠ¶æ€æœºåº”ç”¨é€»è¾‘
3. æ·»åŠ commitIndexç®¡ç†

### ä¼˜å…ˆçº§3: æŒä¹…åŒ–å­˜å‚¨ ğŸŸ¢
1. å®ç°çŠ¶æ€æŒä¹…åŒ–æ¥å£
2. æ·»åŠ æ•…éšœæ¢å¤é€»è¾‘
3. åˆ›å»ºæ–‡ä»¶å­˜å‚¨å®ç°

---

**å½“å‰è¿›åº¦: Leaderé€‰ä¸¾å®Œæˆ âœ… | ä¸‹ä¸€æ­¥: å®ç°æ—¥å¿—å¤åˆ¶ ğŸ¯**

æ­å–œå®ŒæˆLeaderé€‰ä¸¾ï¼ç»§ç»­æœç€å®Œæ•´çš„Raftå®ç°å‰è¿›ï¼ğŸš€ 